@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@Styles.Render("~/lib/DataTables/dataTables")
@Styles.Render("~/lib/pagination/pagination")

<div class="header">

    <h1 class="page-title">资源管理</h1>
</div>

<ul class="breadcrumb">
    <li><a href="/Admin/Member">首页</a> <span class="divider">/</span></li>
    <li class="active">资源管理</li>
</ul>

<div class="container-fluid">
    <div class="row-fluid">

        <div class="btn-toolbar">
            <button class="btn btn-primary"><i class="icon-plus"></i>添加资源</button>
            <button class="btn">导入</button>
            <button class="btn">导出</button>
            <div class="btn-group">
            </div>
        </div>
        <div class="well">
            <table class="table responsive-table responsive-table-on" id="resource-table">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>资源名称</th>
                        <th>资源内容</th>
                        <th>资源语言</th>
                        <th style="width: 100px;"></th>
                    </tr>
                </thead>
            </table>
        </div>


        <div class="modal small hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h3 id="myModalLabel">Delete Confirmation</h3>
            </div>
            <div class="modal-body">
                <p class="error-text">
                    <i class="icon-warning-sign modal-icon"></i>Are you sure you want to delete the user?
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal">Delete</button>
            </div>
        </div>
        <footer>
            <hr>
            <p class="pull-right">
                Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a>
            </p>

            <p>
                &copy; 2012 <a href="#" target="_blank">Portnine</a>
            </p>
        </footer>

    </div>
</div>

@section ScriptSection{

    @Scripts.Render("~/bundles/IndexCommon")
    @Scripts.Render("~/bundles/dataTables")
    @Scripts.Render("~/bundles/libs/lodash")
    <script>

    var table, contentsUI;

    newUrl = function () {
        return "/api/resource/paging";
    };

    freshData = function () {
        if (table) {
            table.fnReloadAjax(newUrl());
            table.fnPageChange('first');
        }
    };

    $(document).ready(function () {
        loadTable();
    });

    loadTable = function () {
        table = $('#resource-table').dataTable({
            "oLanguage": {
                "sUrl": "/lib/datatables/i18n/en-us.js"
            },
            "sPaginationType": "full_numbers",
            "bAutoWidth": true,
            "aLengthMenu": [10, 20, 50, 100, 200],

            'sDom': '<"dataTables_header"lfr>t<"dataTables_footer"ip>',

            "bProcessing": true,
            "bServerSide": true,
            "bStateSave": true,
            "aaSorting": [[1, 'desc']],

            "sAjaxSource": newUrl(),
            "aoColumns": [
                {
                    mData: "id",
                    sTitle: "序号",
                    sType: "string",
                    mSearchOptions: { bOutTable: false },
                    mOrder: "Id"
                },
               {
                   mData: "name",
                   sTitle: "资源名称",
                   sType: "string",
                   mSearchOptions: { bOutTable: false },
                   bSearchable: false,
                   bSortable: false
               },
            {
                mData: "value",
                sTitle: "资源内容",
                sType: "string",
                mSearchOptions: { bOutTable: false },
                bSearchable: false
            },
            {
                mData: "culture",
                sTitle: "语言",
                sType: "string",
                mSearchOptions: { bOutTable: false },
                bSearchable: false
            },
            {
                mData: "id",
                bSortable: false,
                bSearchable: false,
                mRender: function (oObj, sVal, tea) {
                    var html;
                    html = "<span class=\"button-group compact\">";
                    html = html + "<a title=\"@EasyResource.Value("UI_Edit")\" class=\"button  with-tooltip\" href=\"javascript:void('0');\" onclick=\"javascript: editResource('" + oObj + "');\">@EasyResource.Value("UI_Edit")</a> | ";
                    html = html + "<a title=\"@EasyResource.Value("UI_Delete")\" class=\"button with-tooltip\" href=\"javascript:void('0');\" onclick=\"javascript: deleteResource('" + oObj + "');\">@EasyResource.Value("UI_Delete")</a>";
                    html = html + "</span>";
                    return html;
                }
            }
            ],
            "fnServerData": fnServerOData,
            "bUseODataViaJSONP": false
        });
    };

    function clearStudentTable() {
        $('tbody').html("");
    }

    function deleteStudent(id) {
        var delStudent = function (id) {
            $.ajax(
            {
                type: 'DELETE',
                url: "/api/student/" + id,
                beforeSend: function (XMLHttpRequest) {
                },
                success: function (result) {
                    freshData();
                }
            });
        };
        confirmMsgModal("@EasyResource.Value("UI_MsgTitle_DeleteStudent")", "@EasyResource.Value("UI_MsgContent_DeleteStudent")", delStudent, function () { }, id);
    }

    /*****paging function end********/
    /********************************/

    function editResource(Id) {
        alert(Id);
        //window.location.href = "/Teacher/Student/Edit/" + studentId;
    }

    var resetPasswordForm;

    function resetPassword(userName) {
        resetPasswordForm = popWin('/account/ResetPassword?userName=' + userName, '@EasyResource.Value("UI_MsgTitle_ResetPassword")', 600, 400);
    }

    function viewCertificates(studentId) {
        popWin('/teacher/student/viewcertificates?studentId=' + studentId, '@EasyResource.Value("UI_MsgTitle_ViewCertificates")', 800, 600);
    }

    function closeResetPaswordForm() {
        resetPasswordForm.closeModal();
    }

    function createStudent() {
        if ($.userInfo.roles[0] === $.roleEnum.RegisteredTeacher) {
            var limitCount = 0, studentCount = 0;
            app.ajax.getSync("/api/student/count",
                function (result) {
                    if (result) {
                        studentCount = result;
                    }
                });
            app.ajax.getSync("/api/profile/BasicAccountStudentCountLimit",
                function (result) {
                    if (result) {
                        limitCount = parseInt(result.value);
                    }
                });

            if (limitCount !== 0 && studentCount >= limitCount) {
                msgModal3("@EasyResource.Value("UI_MsgContent_OnlyCreateLimitBasicUser")".format(limitCount));
                return;
            }
        }
        window.location.href = "/teacher/student/create";
    }


    </script>
}




